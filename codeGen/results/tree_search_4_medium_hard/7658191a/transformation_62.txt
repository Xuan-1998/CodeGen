dp = {(0, 0): arr[1]}
for i in range(2, n+1):
    dp[(i-1, k-1)] = max(dp.get((i-2, k), 0) + arr[i], dp.get((i-z, min(k-1, z)), 0) + arr[i-1])
dp[(n-1, k)]
