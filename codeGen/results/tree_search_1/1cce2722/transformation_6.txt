Consider dp[i] to be the maximum score obtained by considering all appearances of number i in the sequence, and deciding whether to take or not take number i and its consequences.
Fill the dp table top-down, starting with the largest element and moving down to the smallest element, using memoization to store and reuse the results of subproblems.
