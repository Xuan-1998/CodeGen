Let dp[i][j] be the number of valid sequences that can be formed by using the first i sets, where j represents whether the last element of set i is equal to the last element of set i-1 (j is a boolean).
dp[i] = dp[i-1] * (|A_i| - (i > 1 and A_i[-1] == A_{i-1}[-1]))
