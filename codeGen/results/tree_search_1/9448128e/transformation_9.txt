Let dp[i][j] be the number of valid sequences that can be formed by using the first i sets, where j represents whether the last element of set i is equal to the last element of set i-1 (j is a boolean).
dp[i][j] = dp[i-1][1-j] * (|A_i| - 1) if j == 0 else dp[i-1][1-j] * (|A_i| - count(A_i, A_{i-1}[-1]))
